# 청사진 (Blueprint)

## 개요

이 프로젝트는 사용자의 현재 나이, 은퇴 나이 및 인생의 여러 이벤트를 기반으로 시간 경과에 따른 자산 평가액을 예측하는 은퇴 시뮬레이터입니다. 동적이고 이벤트에 기반한 시스템을 사용하여 사용자의 일생에 걸친 투자 전략, 기여금 및 현금 흐름의 변화를 모델링합니다. 모든 데이터는 지속성을 위해 브라우저에 로컬로 저장됩니다.

## 스타일 및 디자인

- **전체 디자인:** TailwindCSS를 활용하여 깨끗하고 데이터 중심적인 현대적 UI를 구현했습니다. 다크 모드를 완벽하게 지원하여 사용자에게 편안한 시각적 경험을 제공합니다.
- **레이아웃:** 주요 기능인 '기본 정보', '시나리오', '시뮬레이션 결과' 섹션으로 명확하게 구분되어 있어 사용자가 쉽게 탐색하고 상호작용할 수 있습니다.
- **컴포넌트:**
    - **시나리오 타임라인:** 사용자가 설정한 금융 이벤트를 **나이와 월 순서**로 정렬하여 수직 타임라인 형태로 시각화합니다. 이를 통해 시간의 흐름에 따른 재정 계획의 변화를 직관적으로 파악할 수 있습니다.
    - **결과 테이블:** 연도별 상세 데이터를 테이블 형식으로 제공하며, 각 행은 클릭 시 해당 연도의 월별 상세 내역을 볼 수 있도록 확장됩니다.
    - **자산 성장 차트:** Chart.js 라이브러리를 사용하여 투자 원금과 수익을 누적 막대그래프로 시각화하여 자산 성장 추이를 한눈에 파악할 수 있게 합니다.
    - **모달 창:** 시나리오 이벤트나 포트폴리오 프리셋을 추가/수정할 때, 화면 중앙에 모달 창을 띄워 사용자 경험의 연속성을 해치지 않고 작업을 수행할 수 있도록 합니다.

## 주요 기능

- **핵심 시뮬레이션 로직 (`main.js`의 `simulate` 함수):**
    - **월별 정밀 계산:** 사용자의 현재 나이부터 100세까지, 1년을 12개월로 나누어 모든 계산을 월 단위로 정밀하게 수행합니다.
    - **이벤트 적용:** 매월 시뮬레이션 계산 시작 시점에, 해당 **나이와 월**에 적용되어야 할 모든 활성화된 이벤트를 찾아 즉시 반영합니다.
    - **동적 포트폴리오:** `getActivePortfolio` 함수는 특정 나이와 월을 기준으로, 가장 최근에 적용된 포트폴리오 구성 이벤트를 찾아 현재 투자 전략을 결정합니다.
    - **현금 흐름 처리 순서:**
        1.  **투자 및 입금:** 월 정기 투자금과 해당 월에 발생하는 일시불 입금액을 미투자 현금(uninvested cash)에 더합니다.
        2.  **자산 투자:** 미투자 현금을 현재 포트폴리오 비중에 맞게 각 자산에 투자합니다.
        3.  **수익 및 배당 발생:** 투자된 자산을 기준으로 월 수익과 세후 배당금이 계산되어 자산 잔고에 더해집니다.
        4.  **인출:** 사용자가 설정한 '월 정기 인출' 목표액을 기준으로, '월 정기 기타 수입'을 먼저 차감합니다. 부족한 금액이나 해당 월에 발생하는 일시불 출금이 있을 경우, 해당 금액만큼 포트폴리오 자산을 매도하여 인출합니다. (실제 인출액 = (월 인출 목표액 - 월 기타 수입) + 일시불 출금액)
    - **'순 현금흐름'의 정의:** 결과 테이블에 표시되는 '순 현금흐름'은 사용자가 해당 기간 동안 실제로 사용할 수 있는 총 현금을 의미하며, `(월 정기 기타 수입) + (실제 포트폴리오 인출액)` 으로 계산됩니다.

- **이벤트 기반 시나리오 (월 단위 정밀 제어):**
    - 사용자는 이벤트를 생성하거나 수정할 때 **나이**와 **월**을 모두 지정할 수 있습니다.
    - 각 시나리오 카드에는 `(1월부터)`와 같이 적용 시작 월이 명확하게 표시되어 직관성을 높였습니다.
    - **지원 이벤트 유형:**
        - **포트폴리오 변경:** 특정 나이, 특정 월부터 투자 전략(포트폴리오 구성)을 변경합니다.
        - **월 정기 기여금:** 매월 투자하는 금액을 새로 설정하거나 변경합니다.
        - **일시불:** 특정 나이, 특정 월에 발생하는 일회성 입금 또는 출금(마이너스 금액)을 반영합니다.
        - **월 정기 인출:** 은퇴 후 생활비 등 매월 고정적으로 필요한 **목표 인출 금액**을 설정합니다.
        - **월 정기 기타 수입:** 연금 등 투자 외 정기 수입을 설정합니다. 이 수입은 **'월 정기 인출' 목표액을 우선적으로 상쇄**하며, '순 현금흐름'에 포함되어 집계됩니다.

- **데이터 지속성 및 공유:**
    - **로컬 저장소:** 모든 입력 정보, 시나리오, 프리셋은 브라우저의 로컬 스토리지에 자동 저장됩니다.
    - **URL 공유:** `pako.js` 라이브러리로 현재 상태를 압축하여 URL 해시(hash)에 담아 다른 사람과 시뮬레이션 결과를 공유할 수 있습니다.

- **상세 결과 및 툴팁:** 결과 테이블의 각 연도 행에 마우스를 올리면, 해당 연도의 포트폴리오 구성과 자산별 수익/배당 내역, 발생 이벤트 목록(적용 월 포함)을 상세한 툴팁으로 보여줍니다.

- **현지화 (Localization):** 모든 UI 텍스트는 `public/strings.js` 파일에서 관리되며, `data-i18n-key` 속성을 통해 동적으로 HTML에 적용됩니다.

## 현재 계획

**신규 사용자를 위한 '시작 가이드' 기능 추가**

금융 지식이 많지 않은 사용자도 시뮬레이터의 핵심 목표를 쉽게 이해하고 사용할 수 있도록, 단계별 안내를 제공하는 시작 가이드(Onboarding) 기능을 구현합니다.

**구현 단계:**

1.  **HTML 구조 추가:** 가이드 모달창의 기본 HTML을 `index.html`에 추가합니다.
2.  **CSS 스타일링:** 가이드 모달창이 명확하고 시각적으로 매력적으로 보이도록 `style.css`에 스타일을 추가합니다.
3.  **로직 구현 (`main.js`):**
    *   사용자의 첫 방문 여부를 `localStorage`로 확인하여, 첫 방문 시에만 가이드가 표시되도록 합니다.
    *   가이드 내에서 '다음', '이전' 버튼을 통해 단계별(나이 입력 -> 시나리오 추가 등)로 안내하는 기능을 구현합니다.
    *   가이드가 완료되거나 닫힐 때, `localStorage`에 상태를 저장하여 다시 표시되지 않도록 합니다.
4.  **텍스트 추가 (`strings.js`):** 가이드에 사용될 모든 제목, 설명, 버튼 텍스트를 `strings.js`에 추가하여 관리합니다.
